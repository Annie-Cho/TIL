# 로그인 구현 방법
유저의 로그인 정보를 어디에다 저장하느냐의 차이에따라 대표적으로 `세션 방식`과 `토큰 방식`이 있다.  
## 세션 방식

<p align="center">
<img width="785" alt="스크린샷 2022-11-18 오후 11 35 15" src="https://user-images.githubusercontent.com/99185757/202729032-d25b0001-7f72-43ee-80f4-64a915b9dd2a.png" alt="출처 : https://velog.io/@syi9595/JWTJson-Web-Token%EC%9D%80-%EC%99%9C-%EC%82%AC%EC%9A%A9%EB%90%A0%EA%B9%8C">
</p>

- 서버의 DB, 메모리와 같은 자원들을 사용하여 유저의 정보를 저장 및 유지시킨다.<br>
- 진행 과정<br>
  1. 서버는 로그인 시 인증된 유저 정보를 세션에 저장하고 이를 찾을 수 있는 세션ID를 만든다.<br>
  2. 서버는 저장된 세션 정보를 브라우저가 사용할 수 있도록 세션ID를 "Set-Cookie" 헤더에 담아서 전달한다.<br>
  3. 브라우저는 전달된 세션ID를 쿠키에 저장한다.<br>
  4. 브라우저는 해당 도메인을 가진 서버로 요청 시 쿠키에 저장된 세션ID와 함께 요청된다.<br>
  5. 서버는 쿠키에 담긴 세션ID를 통해 인증된 사용자인지 여부를 확인한다.<br><br>
- 서버에 따로 저장하다보니 보안은 강하지만 서버의 확장성이 떨어지고 서버의 자원(세션 저장 및 유지할 공간)이 많이 필요하다.<br>
- 트래픽 분산을 위해 서버를 여러 대 둘 경우, 세션을 참고하기위해 유저는 처음 로그인했던 서버로만 요청을 보내야한다.<br><br>

> 💡 이를 해결하기 위해 토큰 방식이 생겼다.

## 토큰 방식
- 유저 로그인시 발행되는 토큰(JWT)을 브라우저의 저장소에 유지시켜준다.
- 세션 방식과 달리 서버에 저장하지 않기 때문에 서버의 확장성이 좋다.
- 여러 대의 서버에 요청을 보내도 상관없다.(유효한 토큰인지만 체크하면 된다!)

# JWT(JSON Web Token)
다음은 JWT토큰의 구조이다. 왼쪽이 암호화된 토큰, 오른쪽은 복호화되었을 때 토큰이 가지고 있는 정보이다.

<p align="center">
<img width="1220" alt="스크린샷 2022-11-18 오후 11 52 24" src="https://user-images.githubusercontent.com/99185757/202732818-dec9d13b-7426-4e72-be10-f4b1e507b047.png">
</p>

유저가 로그인을 하면 토큰을 생성하여 건내준다. 이 JWT토큰은 암호화된 3가지의 데이터(Header, Payload, Signature)로 영역을 나눌 수 있다.

## Header
- alg : Algorithm. Signature를 만들어내는데 사용되는 알고리즘이 지정된다. 위 예시처럼 HS256 등 여러 암호화 방식 중 하나를 지정할 수 있다.
- typ : Type. JWT토큰이므로 항상 "JWT"문자열이 들어간다.

## Payload
- Base64로 디코딩하면 JSON형식(key: value타입)으로 여러 정보들이 들어있다. 서비스가 토큰을 통해 공개하기 원하는 정보를 담을 수 있다. 이렇게 담긴 데이터들은 Claim이라고 한다.
- sub, name -> 서비스에서 지정하여 담은 데이터
- iat : 토큰 발급 시간
- exp : 토큰 만료 시간

## Signature
- Header와 Payload를 합친 문자열을 Header의 alg에 정의된 알고리즘 방식에 따라 secret key를 이용하여 생성하고 Base64로 암호화된 값이다.
